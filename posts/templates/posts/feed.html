{% extends "users/base.html" %}
{% load static %}
{% load mathfilters %}

{% block body %}
<div class="container mt-4 mb-5">
    <h2 class="text-primary text-center my-3">All Posts</h2>
    <div class="w-75 mx-auto">
        <a href="{% url 'posts:create-post' %}" class="btn btn-primary mb-3" role="button">
            <span class="text-white"><i class="fa-solid fa-plus"></i></span>
            Create Post
        </a>
    </div>
    {% for post in posts %}
    <div class="card mb-3 w-75 mx-auto border-0 shadow-lg">
        <div class="card-body">
            {% if post.user == user %}
            <h5 class="card-title">
                {% if post.user.profile.profile_image %}
                <img
                    src="{{ post.user.profile.profile_image.url }}"
                    alt="{{ post.user.username }}"
                    class="img-fluid avatar-photo">
                {% else %}
                <img
                    src="{% static 'posts/images/no_profile.png' %}"
                    alt="{{ post.user.username }}"
                    class="img-fluid avatar-photo">
                {% endif %}
                <span class="text-primary">@{{ post.user.username }}(You)</span>
                posted <span class="text-success">{{ post.title }}</span>, on
                <span class="opacity-75 text-secondary">{{ post.created }}</span>
            </h5>
            {% else %}
            <h5 class="card-title">
                {% if post.user.profile.profile_image %}
                <img
                    src="{{ post.user.profile.profile_image.url }}"
                    alt="{{ post.user.username }}"
                    class="img-fluid avatar-photo">
                {% else %}
                <img
                    src="{% static 'posts/images/no_profile.png' %}"
                    alt="{{ post.user.username }}"
                    class="img-fluid avatar-photo">
                {% endif %}
                <span class="text-primary">@{{ post.user.username }}</span>
                posted <span class="text-success">{{ post.title }}</span>, on
                <span class="opacity-75 text-secondary">{{ post.created }}</span>
            </h5>
            {% endif %}
            <div class="card-text opacity-75">{{ post.caption }}</div>
        </div>
        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="card-img-bottom img-thumbnail">
        <div class="icons py-2">
            {% if user in post.liked_by.all %}
            <img src="{% static 'posts/images/full_heart.png' %}"
                alt="like"
                class="img-fluid like-dislike-image px-2"
                onclick="doLike('{{ post.id }}')">
            {% else %}
            <img src="{% static 'posts/images/empty_heart.png' %}"
                alt="like"
                class="img-fluid like-dislike-image px-2"
                onclick="doLike('{{ post.id }}')">
            {% endif %}
            <span class="text-secondary opacity-75">
                {% if post.liked_by.count == 0 %}
                    No Likes
                {% elif post.liked_by.count == 1 %}
                    <b>{{ post.liked_by.first }}</b> Likes this
                {% elif post.liked_by.count == 2 %}
                    <b>{{ post.liked_by.first }}</b> and <b>{{ post.liked_by.count|sub:1 }} other</b> Likes this
                {% elif post.liked_by.count > 1 %}
                    <b>{{ post.liked_by.first }}</b> and <b>{{ post.liked_by.count|sub:1 }} others</b> Likes this
                {% endif %}
            </span>
            <!-- <img src="{% static 'posts/images/comment.png' %}" alt="like" class="img-fluid comment-image px-2"> -->
        </div>
    </div>
    {% endfor %}
</div>
<script type="text/javascript">
    var csrftoken = '{{ csrf_token }}';
</script>
{% endblock body %}